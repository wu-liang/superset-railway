{
  "$schema": "https://railway.app/railway.schema.json",
  "services": [
    {
      "name": "superset-init",
      "type": "dockerfile",
      "source": {
        "repo": "<your-github-repo>",
        "branch": "main",
        "dockerfilePath": "./Dockerfile"
      },
      "startCommand": "superset db upgrade && superset init",
      "volumes": [
        {
          "mountPath": "/app/pythonpath",
          "source": "superset-config"
        }
      ],
      "variables": {
        "SECRET_KEY": {
          "required": true,
          "description": "A strong secret key for Superset encryption (generate with `openssl rand -base64 32`)"
        },
        "REDIS_URL": {
          "value": "${{redis.REDIS_URL}}",
          "required": true,
          "description": "Redis URL for caching and Celery broker (auto-generated by Railway Redis service)"
        },
        "DATABASE_URL": {
          "value": "${{postgres.DATABASE_URL}}",
          "required": true,
          "description": "PostgreSQL URI for Superset metadata (auto-generated by Railway Postgres service)"
        },
        "PYTHONPATH": {
          "value": "/app/pythonpath",
          "required": true,
          "description": "Path to custom Superset configuration"
        },
        "MAPBOX_API_KEY": {
          "required": false,
          "description": "Optional Mapbox API key for map visualizations"
        }
      }
    },
    {
      "name": "superset-app",
      "type": "dockerfile",
      "source": {
        "repo": "<your-github-repo>",
        "branch": "main",
        "dockerfilePath": "./Dockerfile"
      },
      "ports": [
        {
          "port": 8088
        }
      ],
      "startCommand": "/app/docker/entrypoints/run-server.sh",
      "volumes": [
        {
          "mountPath": "/app/pythonpath",
          "source": "superset-config"
        },
        {
          "mountPath": "/app/superset_home",
          "source": "superset-home"
        }
      ],
      "variables": {
        "SECRET_KEY": {
          "required": true,
          "description": "A strong secret key for Superset encryption (generate with `openssl rand -base64 32`)"
        },
        "TAG": {
          "value": "5.0.0",
          "description": "Superset image tag"
        },
        "REDIS_URL": {
          "value": "${{redis.REDIS_URL}}",
          "required": true
        },
        "DATABASE_URL": {
          "value": "${{postgres.DATABASE_URL}}",
          "required": true
        },
        "PYTHONPATH": {
          "value": "/app/pythonpath",
          "required": true
        },
        "MAPBOX_API_KEY": {
          "required": false
        }
      },
      "healthcheck": {
        "path": "/health",
        "timeout": 10
      }
    },
    {
      "name": "superset-worker",
      "type": "dockerfile",
      "source": {
        "repo": "<your-github-repo>",
        "branch": "main",
        "dockerfilePath": "./Dockerfile"
      },
      "startCommand": "celery --app=superset.tasks.celery_app:app worker --pool=prefork -O fair -c 4",
      "volumes": [
        {
          "mountPath": "/app/pythonpath",
          "source": "superset-config"
        }
      ],
      "variables": {
        "SECRET_KEY": {
          "required": true
        },
        "REDIS_URL": {
          "value": "${{redis.REDIS_URL}}",
          "required": true
        },
        "DATABASE_URL": {
          "value": "${{postgres.DATABASE_URL}}",
          "required": true
        },
        "PYTHONPATH": {
          "value": "/app/pythonpath",
          "required": true
        }
      }
    },
    {
      "name": "superset-worker-beat",
      "type": "dockerfile",
      "source": {
        "repo": "<your-github-repo>",
        "branch": "main",
        "dockerfilePath": "./Dockerfile"
      },
      "startCommand": "celery --app=superset.tasks.celery_app:app beat --pidfile= --schedule=/tmp/celerybeat-schedule",
      "volumes": [
        {
          "mountPath": "/app/pythonpath",
          "source": "superset-config"
        }
      ],
      "variables": {
        "SECRET_KEY": {
          "required": true
        },
        "REDIS_URL": {
          "value": "${{redis.REDIS_URL}}",
          "required": true
        },
        "DATABASE_URL": {
          "value": "${{postgres.DATABASE_URL}}",
          "required": true
        },
        "PYTHONPATH": {
          "value": "/app/pythonpath",
          "required": true
        }
      }
    },
    {
      "name": "redis",
      "type": "database",
      "image": "redis:7-alpine"
    },
    {
      "name": "postgres",
      "type": "database",
      "image": "postgres:16",
      "variables": {
        "POSTGRES_USER": "superset",
        "POSTGRES_PASSWORD": "superset",
        "POSTGRES_DB": "superset"
      },
      "volumes": [
        {
          "mountPath": "/var/lib/postgresql/data",
          "source": "postgres-data"
        }
      ]
    }
  ],
  "variables": {
    "SECRET_KEY": {
      "required": true,
      "description": "A strong secret key for Superset encryption (generate with `openssl rand -base64 32`)"
    },
    "MAPBOX_API_KEY": {
      "required": false,
      "description": "Optional Mapbox API key for map visualizations"
    }
  }
}
